---
title: "Gene Sequence Data for Link Analysis"
author: "Janis Corona"
date: "3/27/2020"
output: html_document
---

This Rmarkdown file will extract the genes having high Copy Number Variants (CNVs) and fold change expression values in their available data. The information is from the previous GEO data sets used earlier, that also had sequence information as well as gene information. These studies having gene sequence information are: [Alzheimer's Disease (AD)](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE109887), [Colon Cancer](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE135749), [Stomach cancer](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi), [pancreatic cancer](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE131859), a beadchip study done on [uterine leiomyomas (UL)](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi), and a microarry study done on [uterine leiomyomas (UL)](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi). Once these genes having the most CNVs and fold changes are found, a link network will be built to demonstrate how these genes are linked to any of these diseases if applicable. From the top genes of each disease just listed.
```{r}
library(dplyr)
library(tidyr)
library(DT)
library(visNetwork)
library(igraph)
```

The tables being used are from the following disease study files.
- UL_study1_thresholds.csv
- UL_microarray_thresholds.csv
- GastricStomachCancer_Thresholds.csv
- ColonCancerThresholds.csv
- Pancreatic_Cancer_Thresholds.csv
- useableAlzheimerStats.csv

These files will be uploaded to the [github folder of files](https://github.com/JanJanJan2018/VisNetwork_Disease_Gene_Link_Analysis) for this Rmarkdown script that creates a link analysis with visNetwork to display the genes associated with certain diseases and if associated with other diseases.

To skip straight through to the section that builds the visual network analysis of genes related to diseases, search for '%^&' or !!!THE BEGINNING of our VISNETWORK!!! within RStudio. About line 870 of this Rmarkdown file.

***
***
***

Uterine leiomyomas Disease data table.
```{r, eval=FALSE}
ULp <- read.delim('GPL21145-48548.txt', sep='\t', comment.char='#',
                 header=TRUE, na.strings=c('',' ', 'NA'))
head(ULp)
```
These two are from the same study with beadchip expressions.
```{r, eval=FALSE}
UL1 <- read.csv('UL_GSE95101_GPL13376_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))
nonUL1 <- read.csv('nonUL_GSE95101_GPL13376_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))
```

These next two are from different studies with beadchip expressions. These have to be merged with the platform ULp we read in a couple Rmarkdown chunks ago.
```{r, eval=FALSE}
UL2 <- read.csv('UL_GSE120854_GPL23767_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))
nonUL2 <- read.csv('nonUL_GSE120854_GPL23767_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))


```

Keep only the columns needed of ULp, ID, SourceSeq, and CHR.There is no gene symbol to bind to this data table platform GPL21145.
```{r, eval=FALSE}
ULP <- ULp %>% select(ID,SourceSeq,CHR)
UL2b <- UL2 %>% select(-X,-SPOT_ID)
nonUL2b <- nonUL2 %>% select(-X,-SPOT_ID)

colnames(UL2b)[2:25] <- paste('UL',colnames(UL2b)[2:25],sep='_')
colnames(nonUL2b)[2:11] <- paste('nonUL', colnames(nonUL2b)[2:11],sep='_')
```


```{r, eval=FALSE}
UL_2study <- merge(UL2b,nonUL2b, by.x='ID', by.y='ID') 

UL_study2 <- merge(ULP, UL_2study, by.x='ID', by.y='ID')
str(UL_study2)
```

Remove the 'null' values that aren't being recognized by the na.strings or complete.cases. And also the numeric gene expression values are being read in as factors. Do this by writing it to csv and reading it back in and declaring 'null' as an na.string.
```{r, eval=FALSE}
write.csv(UL_study2, 'UL_study2.csv', row.names=FALSE)

```

```{r, eval=FALSE}
UL_study2 <- read.csv('UL_study2.csv', sep=',', header=TRUE, na.strings=c('',' ','NA','null'))
str(UL_study2)
```

Thats great that it now recognizes each column as a numeric data type and that the null values are now being recognized as NA.

Now, lets use complete.cases to get only those observations with complete cases and remove the NA values.
```{r, eval=FALSE}
UL_study2_cc <- UL_study2[complete.cases(UL_study2),]

obsRM <- length(UL_study2$ID) - length(UL_study2_cc$ID)

cat('The number of observations removed is: ', obsRM,'.')
```
Its too bad that we cannot really do anything with this data, unless we open up ubuntu Linux and use the 3.4 version of R to use Bioconductor to get the gene names. But we can at least use the sequences to see if there are any with copies. Not necessarily CNVs because they would have to have the gene names to see what insertions, deletions, skips, etc make the gene a CNV. We can always extract what we need from it now, then get the gene information with a VM of Ubuntu, download the R version and use the tutorial (assuming it works exactly as demonstrated) [online](http://www.bioconductor.org/help/course-materials/2017/BioC2017/Day2/Workshops/ELMER/doc/data.html).

The following are the requirements using the above online tutorial:
- R version 3.4.1 (2017-06-30)
- Platform: x86_64-pc-linux-gnu (64-bit)
- Running under: Ubuntu 16.04.2 LTS

So lets get the median and foldchange median values. We also don't have the cytoband location, but we do have the chromosome for this set. 
```{r, eval=FALSE}
row.names(UL_study2_cc) <- UL_study2_cc$ID
```

```{r, eval=FALSE}
ul <- grep('^UL', colnames(UL_study2_cc))
UL2_t <- UL_study2_cc[,ul]
nUL2_t <- UL_study2_cc[,-c(1:3,ul)]
```

Get the row medians of the UL and nonUL 2nd study data.
```{r, eval=FALSE}
UL2_t$UL_Median <- apply(UL2_t,1,median)
nUL2_t$nonUL_Median <- apply(nUL2_t,1,median)

FoldChange_Median_UL_to_nonUL <- UL2_t$UL_Median/nUL2_t$nonUL_Median

UL_study2_cc$FoldChange_Median_UL_to_nonUL <- FoldChange_Median_UL_to_nonUL
```

```{r, eval=FALSE}
UL2_cnv <- UL_study2_cc %>%
  group_by(SourceSeq) %>%
  mutate(Sequence_CNVs = n()) %>%
  select(ID,SourceSeq,Sequence_CNVs, CHR,FoldChange_Median_UL_to_nonUL, everything()) %>%
  ungroup() %>%
  unique()
```

The above has all unique CNVs of the sequences, as should be expected since there was no error making the row names the ID field.
```{r, eval=FALSE}
write.csv(UL2_cnv, 'UL_study2_needsGeneData.csv', row.names=FALSE)
```

***

Now lets get to the first study of UL gene expression data that we can use to add to our network analysis of genes related to diseases. These two tables are the UL1 and nonUL1 tables.
```{r, eval=FALSE}
nonUL1b <- nonUL1 %>% select(Symbol,SEQUENCE,Chromosome,Cytoband,GSM2496194:GSM2496222)
UL1b <- UL1 %>% select(Symbol,SEQUENCE,Chromosome,Cytoband,GSM2496185:GSM2496220)
colnames(nonUL1b)[5:22] <- paste('nonUL',colnames(nonUL1b)[5:22],sep='_')
colnames(UL1b)[5:24] <- paste('UL',colnames(UL1b)[5:24],sep='_')

```

Add the Median fields to each table.
```{r, eval=FALSE}

UL1c <- UL1b[,5:24]
nUL1c <- nonUL1b[,5:22]

UL1c$UL1_Median <- apply(UL1c,1,median)
nUL1c$nonUL1_Median <- apply(nUL1c,1,median)

FC <- UL1c$UL1_Median/nUL1c$nonUL1_Median

mUL1 <- UL1b[,1:4]
UL_study1 <- cbind(mUL1,UL1c,nUL1c)

UL_study1$FoldChange_Median_UL1_to_nonUL1 <- FC

UL_study1b <- UL_study1 %>% select(Symbol,SEQUENCE,Chromosome,Cytoband,
                                   FoldChange_Median_UL1_to_nonUL1,
                                   UL1_Median,nonUL1_Median,
                                   everything())
```


There are some missing values in the chromosome and cytoband fields, but we don't need to omit them yet.
```{r, eval=FALSE}
colSums(is.na(UL_study1b))
```
The above shows that there aren't any missing values in the samples or the sequence fields, but there are some in the gene symbol, chromosome, and cytoband fields.

Lets get the CNVs of the genes now, but remove the NAs from the Symbol field first.
```{r, eval=FALSE}
UL_study1b2 <- UL_study1b[complete.cases(UL_study1b$Symbol),]
UL_study1_cnv <- UL_study1b2 %>%
  group_by(Symbol) %>%
  mutate(Symbol_CNVs = n()) %>%
  select(Symbol,Symbol_CNVs,everything()) %>%
  ungroup() %>%
  unique()
```

Lets look at what we have for our first few fields and the values.
```{r, eval=FALSE}
head(UL_study1_cnv[,1:6])
```

This is going to grab our target genes for those genes that have a CNV gene count greater than the top 90th percentile and also is either of the bottom 5th percentile or top 95th percentile for fold change median values of UL to nonUL gene expression values.
```{r, eval=FALSE}
UL_study1_thresholds <- subset(UL_study1_cnv, 
                          UL_study1_cnv$Symbol_CNVs > quantile(UL_study1_cnv$Symbol_CNVs,.9) &
                          (UL_study1_cnv$FoldChange_Median_UL1_to_nonUL1 < 
                            quantile(UL_study1_cnv$FoldChange_Median_UL1_to_nonUL1,.05) |
                          UL_study1_cnv$FoldChange_Median_UL1_to_nonUL1 > 
                            quantile(UL_study1_cnv$FoldChange_Median_UL1_to_nonUL1,.95))
                        )

```


Lets now order this table by CNV and Fold Change values.
```{r, eval=FALSE}
UL_study1_ordered <- UL_study1_thresholds[with(UL_study1_thresholds,
                        order(Symbol_CNVs,FoldChange_Median_UL1_to_nonUL1,
                              decreasing=TRUE)),]
```


Lets take a look at the top few rows and first few columns of this table of threshold value target genes for UL.
```{r, eval=FALSE}
head(UL_study1_ordered[,1:7])
```

The table is ordered by CNVs first then by fold change values within the top CNVs. Lets write this to csv and use it later for our visNetwork. So far, it looks like either the Chromosome or the cytoband could be used for location of the nodes. But we could also group the genes by link to gene disease networks, gene networks, or anything else we get ideas about later. 
```{r, eval=FALSE}
write.csv(UL_study1_ordered,'UL_study1_thresholds.csv',row.names=FALSE)
```

***
UL microarray study
Uterine leiomyomas Disease data table (microarray data).
These two are from the same study with microarray expressions.
```{r, eval=FALSE}
UL1 <- read.csv('UL_GSE68295_GPL6480_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))
nonUL1 <- read.csv('nonUL_GSE68295_GPL6480_table.csv', sep=',',header=TRUE,
                  na.strings=c('',' ','NA'))
```

```{r, eval=FALSE}
colnames(UL1)
colnames(nonUL1)
```

Lets keep only the columns interested in. Those are 
```{r, eval=FALSE}
nonUL1b <- nonUL1 %>% select(GENE_SYMBOL,SEQUENCE,CYTOBAND,GSM1667144:GSM1667146)
UL1b <- UL1 %>% select(GENE_SYMBOL,SEQUENCE,CYTOBAND,GSM1667147:GSM1667149)


colnames(nonUL1b)[4:6] <- paste('nonUL',colnames(nonUL1b)[4:6],sep='_')
colnames(UL1b)[4:6] <- paste('UL',colnames(UL1b)[4:6],sep='_')

```

Add the Median fields to each table.
```{r, eval=FALSE}

UL1c <- UL1b[,4:6]
nUL1c <- nonUL1b[,4:6]

UL1c$UL1_MedianArray <- apply(UL1c,1,median)
nUL1c$nonUL1_MedianArray <- apply(nUL1c,1,median)

FC <- UL1c$UL1_MedianArray/nUL1c$nonUL1_MedianArray

mUL1 <- UL1b[,1:3]
UL_study1 <- cbind(mUL1,UL1c,nUL1c)

UL_study1$FoldChange_MedianArray_UL1_to_nonUL1 <- FC

UL_study1b <- UL_study1 %>% select(GENE_SYMBOL,SEQUENCE,CYTOBAND,
                                   FoldChange_MedianArray_UL1_to_nonUL1,
                                   UL1_MedianArray,nonUL1_MedianArray,
                                   everything())
```


There are some missing values in the GENE_SYMBOL, SEQUENCE, and CYTOBAND fields, but we don't need to omit them yet.
```{r, eval=FALSE}
colSums(is.na(UL_study1b))
```
The above shows that there aren't any missing values in the samples or the sequence fields, but there are some in the gene symbol, chromosome, and cytoband fields.

Lets get the CNVs of the genes now, but remove the NAs from the Symbol field first.
```{r, eval=FALSE}
UL_study1b2 <- UL_study1b[complete.cases(UL_study1b$GENE_SYMBOL),]

UL_study1_cnv <- UL_study1b2 %>%
  group_by(GENE_SYMBOL) %>%
  mutate(GENE_SYMBOL_CNVs = n()) %>%
  select(GENE_SYMBOL,GENE_SYMBOL_CNVs,everything()) %>%
  ungroup() %>%
  unique()
```

Lets look at what we have for our first few fields and the values.
```{r, eval=FALSE}
head(UL_study1_cnv[,1:6])
```

This is going to grab our target genes for those genes that have a CNV gene count greater than the top 90th percentile and also is either of the bottom 5th percentile or top 95th percentile for fold change median values of UL to nonUL gene expression values.
```{r, eval=FALSE}
UL_study1_thresholds <- subset(UL_study1_cnv, 
                          UL_study1_cnv$GENE_SYMBOL_CNVs > quantile(UL_study1_cnv$GENE_SYMBOL_CNVs,.9) &
                          (UL_study1_cnv$FoldChange_MedianArray_UL1_to_nonUL1 < 
                            quantile(UL_study1_cnv$FoldChange_MedianArray_UL1_to_nonUL1,.05) |
                          UL_study1_cnv$FoldChange_MedianArray_UL1_to_nonUL1 > 
                            quantile(UL_study1_cnv$FoldChange_MedianArray_UL1_to_nonUL1,.95))
                        )

```


Lets now order this table by CNV and Fold Change values.
```{r, eval=FALSE}
UL_study1_ordered <- UL_study1_thresholds[with(UL_study1_thresholds,
                        order(GENE_SYMBOL_CNVs,FoldChange_MedianArray_UL1_to_nonUL1,
                              decreasing=TRUE)),]
```


Lets take a look at the top few rows and first few columns of this table of threshold value target genes for UL.
```{r, eval=FALSE}
head(UL_study1_ordered[,1:7])
```

The table is ordered by CNVs first then by fold change values within the top CNVs. Lets write this to csv and use it later for our visNetwork. So far, it looks like either the Chromosome or the cytoband could be used for location of the nodes. But we could also group the genes by link to gene disease networks, gene networks, or anything else we get ideas about later. 
```{r, eval=FALSE}
write.csv(UL_study1_ordered,'UL_microarray_thresholds.csv',row.names=FALSE)
```

***
Gastric Stomach Cancer data table.
```{r, eval=FALSE}
GSC <- read.delim('GSE64916_series_matrix.txt', sep='\t', comment.char='!',
                 header=TRUE, na.strings=c('',' ', 'NA'))
head(GSC)
```
These are samples of gastric stomach cancer gene expressions in located peripheral blood. The samples GSM1583284, GSM1583285, GSM1583286, and GSM1583287 are GSC, and the control of this study is from the blood of a person without gastric stomach cancer in GSM1583288.

Lets label these columns to be their sample types.
```{r, eval=FALSE}
colnames(GSC) <- c("ID","GSC1","GSC2","GSC3","GSC4","noGSC_ctrl")
head(GSC)
```


```{r, eval=FALSE}
GSCp <- read.delim('GPL13497-9755.txt', sep='\t',header=TRUE, comment.char='#',
                  na.strings=c('',' ','NA'))
head(GSCp)
```

Lets keep the ID, GENE_SYMBOL, CYTOBAND, and SEQUENCE columns of our platform meta data.
```{r, eval=FALSE}
GSC_P <- GSCp %>% select(ID, GENE_SYMBOL, CYTOBAND, SEQUENCE)
head(GSC_P)
```

Now lets combine the two data tables of sample and meta information.
```{r, eval=FALSE}
GSC2 <- merge(GSC_P, GSC, by.x='ID',by.y='ID')
head(GSC2)
```

We will now remove the NAs from the Gene Symbol field.
```{r, eval=FALSE}
GSC3 <- GSC2[complete.cases(GSC2$GENE_SYMBOL),]
head(GSC3)
```


Lets group by gene and get the count of each gene and attach it to the sequence information.
```{r, eval=FALSE}
GSC4 <- GSC3 %>%
  group_by(GENE_SYMBOL) %>%
  mutate(GENE_CNVs = n()) %>%
  select(GENE_SYMBOL, GENE_CNVs, everything()) %>%
  ungroup() %>%
  unique()

colnames(GSC4)
```

Now, we will add the fold change of median values of the GSC samples to the control sample of a healthy person.
```{r, eval=FALSE}
GSC4$GSC_Median <- apply(GSC4[6:9],1,median)
GSC4$FoldChangeMedian_GSC_to_healthyCtrl <- GSC4$GSC_Median/GSC4$noGSC_ctrl

GSC5 <- GSC4 %>% select(GENE_SYMBOL, GENE_CNVs,-ID,CYTOBAND,SEQUENCE,
                        FoldChangeMedian_GSC_to_healthyCtrl,GSC_Median, GSC1:noGSC_ctrl)
colnames(GSC5)
```

Lets get the subset of GSC that has the genes with a high number of CNVs and a high Fold change by median values. 
```{r, eval=FALSE}
GSC_genes <- subset(GSC5, GSC5$GENE_CNVs > median(GSC5$GENE_CNVs) &
                (GSC5$FoldChangeMedian_GSC_to_healthyCtrl < 
                   quantile(GSC5$FoldChangeMedian_GSC_to_healthyCtrl, 0.05) |
                 GSC5$FoldChangeMedian_GSC_to_healthyCtrl > 
                   quantile(GSC5$FoldChangeMedian_GSC_to_healthyCtrl, 0.95)
                )
             )

length(unique(GSC_genes$GENE_SYMBOL))
```
That is too many genes to make the targeted gastric stomach cancer genes, so we will raise our CNV threshold to the top 99th percentile.
```{r, eval=FALSE}
GSC_genes <- subset(GSC5, GSC5$GENE_CNVs > quantile(GSC5$GENE_CNVs,0.99) &
                (GSC5$FoldChangeMedian_GSC_to_healthyCtrl < 
                   quantile(GSC5$FoldChangeMedian_GSC_to_healthyCtrl, 0.05) |
                 GSC5$FoldChangeMedian_GSC_to_healthyCtrl > 
                   quantile(GSC5$FoldChangeMedian_GSC_to_healthyCtrl, 0.95)
                )
             )

length(unique(GSC_genes$GENE_SYMBOL))
```

Lets order this table of targeted genes by CNV count then by decreasing value of fold change from GSC to healthy as a ratio.
```{r, eval=FALSE}
GSC6 <- GSC_genes[with(GSC_genes, order(GENE_CNVs,FoldChangeMedian_GSC_to_healthyCtrl,
                              decreasing=TRUE)),]
head(GSC6)

```


Lets write this file out to csv and work on the other disease data sets separate from this one.
```{r, eval=FALSE}
write.csv(GSC6, 'GastricStomachCancer_Thresholds.csv', row.names=FALSE)
```

***
Colon cancer data table.
```{r, eval=FALSE}
CC <- read.delim('GSE135749_series_matrix.txt', sep='\t', comment.char='!',
                 header=TRUE, na.strings=c('',' ', 'NA'))
head(CC)
```

```{r, eval=FALSE}
CCp <- read.delim('GPL10558-50081.txt', sep='\t',header=TRUE, comment.char='#',
                  na.strings=c('',' ','NA'))
head(CCp)
```


```{r, eval=FALSE}
colnames(CC)
```


```{r, eval=FALSE}
colnames(CCp)
```

Keep only the SYMBOL, ID, Cytoband, and SEQUENCE columns of the CC platform to combine with the CC samples by ID_REF.
```{r, eval=FALSE}
CC_p <- CCp %>% select(ID, Symbol,SEQUENCE,Cytoband)
```

The CC data set will be produced by this next command.
```{r, eval=FALSE}
CC_1 <- merge(CC_p,CC, by.x='ID', by.y='ID_REF')
head(CC_1)
```
Note: Since these are quantile normalized, and there are various ways and reasons to do this, but the purpose being primarily to eliminate noise, we will keep the values, for our purposes, we are still getting those threshold genes that are in the bottom 5th and top 95th percentile while also having more CNVs than the median CNVs of all genes in this set.

We should separate the columns that are samples of colon cancer tumors without treatment of the short hairpin RNAs (shRNA) targeting two different RNAs of LGR5. The first sample columns are the control colon cancer samples, the next two are the first type of LGR5 being knocked down with a shRNA, and the last two samples as columns are the 2nd type of LGR5 being knocked down with the 2nd type of shRNA.

These are colon cancer tumor cells. with two replicates of each sample type or group. We will prepend cc0, cc1,cc2 to these 6 samples for if no shRNA knockdown (cc0), the 1st type shRNA (cc1), or the 2nd type shRNA (cc2) is what the sample is a product of procedure type.
```{r, eval=FALSE}
colnames(CC_1)[5:6] <- paste('cc0', colnames(CC_1)[5:6],sep='_')
colnames(CC_1)[7:8] <- paste('cc1', colnames(CC_1)[7:8],sep='_')
colnames(CC_1)[9:10] <- paste('cc2', colnames(CC_1)[9:10],sep='_')
```

```{r, eval=FALSE}
colnames(CC_1)
```

Now, lets add in the median values of the samples of these three groups of control, knockdown 1, and knockdown 2. The median values will be knockdown 1 compared to control, and knockdown 2 compared to control.We want to be consistent with the methods of our other disease type sample extraction of target genes, so even though there are only two samples of each group, the median is used. Notice the median seems to be programmed to be the mean when there are only two samples.
```{r, eval=FALSE}
cc0 <- apply(CC_1[5:6],1,median)
cc1 <- apply(CC_1[7:8],1,median)
cc2 <- apply(CC_1[9:10],1,median)

FoldChange_CC1_to_CC0 <- cc1/cc0
FoldChange_CC2_to_CC0 <- cc2/cc0
```

Add these median and fold change values to our colon cancer table, CC_1.
```{r, eval=FALSE}
CC_1$ctrl_CC_median <- cc0
CC_1$group1_CC_median <- cc1
CC_1$group2_CC_median <- cc2
CC_1$FoldChange_CC1_to_CC0 <- FoldChange_CC1_to_CC0
CC_1$FoldChange_CC2_to_CC0 <- FoldChange_CC2_to_CC0

colnames(CC_1)
```

Rearrange the columns to see the stats and meta information before the sample information.
```{r, eval=FALSE}
CC2 <- CC_1 %>% select(ID:Cytoband, FoldChange_CC1_to_CC0:FoldChange_CC2_to_CC0,
                       ctrl_CC_median:group2_CC_median,everything())
colnames(CC2)
```

Lets group by gene and get the count of each gene and attach it to the sequence information.
```{r, eval=FALSE}
CC3 <- CC2[complete.cases(CC2$Symbol),]

CC4 <- CC3 %>%
  group_by(Symbol) %>%
  mutate(Symbol_CC_CNVs = n()) %>%
  select(Symbol, Symbol_CC_CNVs, everything()) %>%
  ungroup() %>%
  unique()
```

Now, lets get our threshold values so that the genes with CNVs greater than the median value of CNVs of genes in our data set are selected and also those genes in that group but also having a threshold of being in the bottom 5th and top 95th percentile for fold change values of group1/control and group2/control are selected as target genes.
```{r, eval=FALSE}
CC5 <- subset(CC4, 
              (CC4$Symbol_CC_CNVs > median(CC4$Symbol_CC_CNVs)) &
               (CC4$FoldChange_CC1_to_CC0 < quantile(CC4$FoldChange_CC1_to_CC0,.05, na.rm=TRUE) 
               | 
                CC4$FoldChange_CC1_to_CC0 > quantile(CC4$FoldChange_CC1_to_CC0,.95, na.rm=TRUE)
               )
              |  
              (CC4$Symbol_CC_CNVs > median(CC4$Symbol_CC_CNVs))  
               &            
              (CC4$FoldChange_CC2_to_CC0 < quantile(CC4$FoldChange_CC2_to_CC0,.05, na.rm=TRUE) 
               |               
               CC4$FoldChange_CC2_to_CC0 > quantile(CC4$FoldChange_CC2_to_CC0,.95, na.rm=TRUE)) 
              )
```

There are a lot of observations for this threshold dataset of targeted colon cancer genes. Lets see how many genes are unique.
```{r, eval=FALSE}
length(unique(CC5$Symbol))
```
That is a lot of genes as gene targets, so lets set a higher threshold for the genes with CNVs higher than the 97th percentile.
```{r, eval=FALSE}
CC6 <- subset(CC4, 
              (CC4$Symbol_CC_CNVs > quantile(CC4$Symbol_CC_CNVs,.97)) &
               (CC4$FoldChange_CC1_to_CC0 < quantile(CC4$FoldChange_CC1_to_CC0,.05, na.rm=TRUE) 
               | 
                CC4$FoldChange_CC1_to_CC0 > quantile(CC4$FoldChange_CC1_to_CC0,.95, na.rm=TRUE)
               )
              |  
              (CC4$Symbol_CC_CNVs > quantile(CC4$Symbol_CC_CNVs,.97))  
               &            
              (CC4$FoldChange_CC2_to_CC0 < quantile(CC4$FoldChange_CC2_to_CC0,.05, na.rm=TRUE) 
               |               
               CC4$FoldChange_CC2_to_CC0 > quantile(CC4$FoldChange_CC2_to_CC0,.95, na.rm=TRUE)) 
              )
```

This dataset is much better to work with for targeted genes based on our set threshold limits as discriminates. Lets see how many are unique.
```{r, eval=FALSE}
length(CC6$Symbol)
```

Lets order this data table by CNVs then by fold change decreasing by group1 then by group2. 
```{r, eval=FALSE}
CC7 <- CC6[with(CC6, order(Symbol_CC_CNVs,FoldChange_CC1_to_CC0,
                           FoldChange_CC2_to_CC0, decreasing=TRUE)),]
```


If we can't get the CYTOBAND for the other diseases then we will leave it out or add it in later if there are few to look up and add manually.
Lets write this file out to csv and work on the other disease data sets separate from this one.
```{r, eval=FALSE}
write.csv(CC7, 'ColonCancerThresholds.csv', row.names=FALSE)
```

***
Pancreatic cancer data table.
```{r, eval=FALSE}
PC <- read.delim('GSE131859_non-normalized.txt', sep='\t', comment.char='!',
                 header=TRUE, na.strings=c('',' ', 'NA'))
head(PC)
```

```{r, eval=FALSE}
PCp <- read.delim('GPL14951-11332.txt', sep='\t',header=TRUE, comment.char='#',
                  na.strings=c('',' ','NA'))
head(PCp)
```


```{r, eval=FALSE}
colnames(PC)
```

These samples have the pvalue scores attached to the sample microarray readings. We aren't interested in these pval fields, so we will remove them and the added X field when loading of the row numbers when saved to csv from other file.
```{r, eval=FALSE}
PC1 <- PC %>% select(-MiaPACA2_EV.Detection_Pval,-MiaPACA2_ARHGEF10.Detection_Pval,
                     -Hs766T_shGFP.Detection_Pval,-Hs766T_shARHGEF10.Detection_Pval,-X)
head(PC1)
```

We have four samples of pancreatic cancer. MiaPACA2_EV is the control of pancreatic cancer epithelial cells. The idea is to show that ARHGEF10 is a tumor suppressor by examining two cell lines of available commercial pancreatic cancer cells where MiaPACA2 is directly from the epithelial pancreatic cells and Hs766T are from the lymph nodes of someone with pancreatic cancer. MiaPACA2_ARHGEF10 sample is when ARHGEF10 is overexpressed to demonstrate suppression of pancreatic cancer cells not mutating. The Hs766T_shGFP is the sample where the short hair pin RNA additive to eliminate the tumor suppressor ARHGEF10 wasn't added and is the lymph node pancreatic cancer control. The Hs766T_shARHGEF10 is when the Hs766T cell line of pancreatic cancer cells had the ARHGEF10 gene knocked down or suppressed. Lets rename these column samples by what they are,

```{r, eval=FALSE}
colnames(PC1) <- c('ID_REF','PC_epithelial_ctrl','PC_epithelial_SuppressorAdded',
                   'PC_lymph_ctrl','PC_lymph_SuppressorKnockedOut')

```


```{r, eval=FALSE}
colnames(PCp)
```

Keep only the Symbol, Cytoband, ID, and SEQUENCE columns of the PC platform to combine with the PC samples by ID_REF and GENE_SYMBOL.
```{r, eval=FALSE}
PC_p <- PCp %>% select(ID, Symbol, SEQUENCE, Cytoband)
head(PC_p)
```

The PC data set will be produced by this next chunk.
```{r, eval=FALSE}
PC2 <- merge(PC_p,PC1, by.x='ID', by.y='ID_REF')
head(PC2)
```

Since there is only one sample of each, it is redundant to get the median of each type, so we will get the fold change values of the suppresor added epithelial PC cells to the epithelial PC cells control, and the fold change values of the lymph node PC cells with the suppressor knocked out or suppressed to the lymph node PC cells control.
```{r, eval=FALSE}
FC_epithelial_PC <- PC2$PC_epithelial_SuppressorAdded/PC2$PC_epithelial_ctrl
FC_lymphNode_PC <- PC2$PC_lymph_SuppressorKnockedOut/PC2$PC_lymph_ctrl

PC2$FC_epithelial_PC <- FC_epithelial_PC
PC2$FC_lymphNode_PC <- FC_lymphNode_PC

PC3 <- PC2 %>% select(ID:Cytoband, FC_epithelial_PC,FC_lymphNode_PC, everything())
```


Lets group by gene and get the count of each gene and attach it to the sequence information.
```{r, eval=FALSE}
PC4 <- PC3 %>%
  group_by(Symbol) %>%
  mutate(GENE_CNVs = n()) %>%
  select(Symbol, GENE_CNVs, everything()) %>%
  ungroup() %>%
  unique()

colnames(PC4) <- gsub('FC_','FoldChange_', colnames(PC4))
colnames(PC4)
```


```{r, eval=FALSE}
PC5 <- PC4[with(PC4, order(GENE_CNVs, FoldChange_epithelial_PC, 
                                        FoldChange_lymphNode_PC, decreasing=TRUE)),]
```

Get the subset of AD that has the genes with a high number of CNVs and a high Fold change by median values. 
```{r, eval=FALSE}
PC_genes <- subset(PC5, PC5$GENE_CNVs > median(PC5$GENE_CNVs, na.rm=TRUE) &
                    (PC5$FoldChange_epithelial_PC < 
                       quantile(PC5$FoldChange_epithelial_PC,0.05, na.rm=TRUE) |
                    PC5$FoldChange_lymphNode_PC > 
                      quantile(PC5$FoldChange_lymphNode_PC, .95, na.rm=TRUE))
                  )

length(unique(PC_genes))

```
This is a lot of unique genes, so lets filter more by making the CNVs to be in the top 95th percentile of CNV counts instead of greater than the median of gene CNVs.
```{r, eval=FALSE}
PC_genes2 <- subset(PC5, PC5$GENE_CNVs > quantile(PC5$GENE_CNVs, 0.95,na.rm=TRUE) &
                    (PC5$FoldChange_epithelial_PC < 
                       quantile(PC5$FoldChange_epithelial_PC,0.05, na.rm=TRUE) |
                    PC5$FoldChange_lymphNode_PC > 
                      quantile(PC5$FoldChange_lymphNode_PC, .95, na.rm=TRUE))
                  )
length(unique(PC_genes2))

```
That is a much better quantity to work with for targeted Pancreatic Cancer genes. Lets order this by CNVs then by fold change epithelial then fold change lymph.
```{r, eval=FALSE}
PC6 <- PC_genes2[with(PC_genes2, order(GENE_CNVs,FoldChange_epithelial_PC,
                                       FoldChange_lymphNode_PC, decreasing=TRUE)),]
head(PC6)
```

Lets drop the ID field. 
```{r, eval=FALSE}
PC7 <- PC6 %>% select(-ID)
head(PC7)
```

Lets write this file out to csv and work on the other disease data sets separate from this one.
```{r, eval=FALSE}
write.csv(PC7, 'Pancreatic_Cancer_Thresholds.csv', row.names=FALSE)
```

***
Alzheimer's Disease data table.
```{r, eval=FALSE}
AD <- read.delim('GSE109887_series_matrix.txt', sep='\t', comment.char='!',
                 header=TRUE, na.strings=c('',' ', 'NA'))
head(AD)
```

```{r, eval=FALSE}
ADp <- read.delim('GPL4133-12599.txt', sep='\t',header=TRUE, comment.char='#',
                  na.strings=c('',' ','NA'))
head(ADp)
```


```{r, eval=FALSE}
colnames(AD)
```


```{r, eval=FALSE}
colnames(ADp)
```

Keep only the GENE_SYMBOL and SEQUENCE columns of the AD platform to combine with the AD samples by ID_REF and GENE_SYMBOL.
```{r, eval=FALSE}
AD_p <- ADp[,c(10,20)]
```

The AD data set will be produced by this next chunk.
```{r, eval=FALSE}
AD_1 <- merge(AD_p,AD, by.x='GENE_SYMBOL', by.y='ID_REF')
head(AD_1)
```

We should separate the columns that are samples of AD patients to those that are the control samples of AD patients.
```{r, eval=FALSE}
metaAD <- read.csv('AlzheimerAgeGenderTissueSamplesMeta.csv',sep=',', header=TRUE,
                   na.strings=c('',' ','NA'))
head(metaAD)
```


```{r, eval=FALSE}
row.names(metaAD) <- metaAD$sampleID
```


```{r, eval=FALSE}
meta_AD <- as.data.frame(t(metaAD))
head(meta_AD)
```

Get the indices of the AD and control patients
```{r, eval=FALSE}
ad <- grep('AD', meta_AD$disease)
#add 1 because of the additional sequence field in AD_1 not in metaAD
ad <- ad+1
```

Paste the type of sample to the sample ID fields.
```{r, eval=FALSE}
colnames(AD_1)[ad] <- paste('AD',colnames(AD_1)[ad],sep='_')
colnames(AD_1)[-c(1,2,ad)] <- paste('ctrl_AD',colnames(AD_1)[-c(1,2,ad)], sep='_')
```

Create separate tables for the AD and the control patients.
```{r, eval=FALSE}
ad1 <- AD_1[,ad]
ctrl_ad1 <- AD_1[,-c(1,2,ad)]
```


Row Means of each subset.
```{r, eval=FALSE}
ad1$Mean_AD <- rowMeans(ad1)
ctrl_ad1$Mean_ctrl_AD <- rowMeans(ctrl_ad1)
```


```{r, eval=FALSE}
ad1$Median_AD <- apply(ad1,1,median)
ctrl_ad1$Median_ctrl_AD <- apply(ctrl_ad1,1,median)
```

Now combine these new value fields to the original table for AD and control mean and median.
```{r, eval=FALSE}
AD_1$Mean_AD <- ad1$Mean_AD
AD_1$Mean_ctrl_AD <- ctrl_ad1$Mean_ctrl_AD
AD_1$Median_AD <- ad1$Median_AD
AD_1$Median_ctrl_AD <- ctrl_ad1$Median_ctrl_AD
```

Remove duplicate entries, the genes even thought they have different sequence values, are showing duplicate or identical gene expression values by gene.
```{r, eval=FALSE}
AD2 <- AD_1[!duplicated(AD_1),]

AD2$FoldChange_Mean_AD_2_ctrl <- AD2$Mean_AD/AD2$Mean_ctrl_AD
AD2$FoldChange_Median_AD_2_ctrl <- AD2$Median_AD/AD2$Median_ctrl_AD

head(AD2)[,c(1,2,83:86)]
```
You can see from the above table that even though the sequence is different in these first displayed genes that the gene the sequences belong to have the same gene expression values. 

Lets group by gene and get the count of each gene and attach it to the sequence information.
```{r, eval=FALSE}
AD3 <- AD2 %>%
  group_by(GENE_SYMBOL) %>%
  mutate(GENE_CNVs = n()) %>%
  select(GENE_SYMBOL, GENE_CNVs, SEQUENCE, Median_AD, Median_ctrl_AD, 
         FoldChange_Mean_AD_2_ctrl, FoldChange_Median_AD_2_ctrl, everything()) %>%
  ungroup() %>%
  unique()
```


```{r, eval=FALSE}
Alzheimer <- AD3[with(AD3, order(GENE_CNVs, GENE_SYMBOL,  decreasing=TRUE)),]
```

Get the subset of AD that has the genes with a high number of CNVs and a high Fold change by median values. 
```{r, eval=FALSE}
AD_genes <- subset(Alzheimer, Alzheimer$GENE_CNVs > median(Alzheimer$GENE_CNVs) &
                              (Alzheimer$FoldChange_Median_AD_2_ctrl < 0.90 |
                              Alzheimer$FoldChange_Median_AD_2_ctrl > 1.10)
                  )
alz_genes <- unique(AD_genes$GENE_SYMBOL)
alz_genes
```


```{r, eval=FALSE}
AD4 <- AD_genes[,c(1:3,7)]
AD4
```

```{r, eval=FALSE}
AD_genes1 <- datatable(data=AD4,  rownames=FALSE,
                      extensions=c('Buttons','Responsive','FixedColumns'),
                      filter=list(position='top'),
                      options=list(pageLength=10,
                        dom='Bfrtip',scrollX = TRUE, fixedColumns = TRUE,
                        buttons=c('colvis','csv'),
                        language=list(sSearch='Filter:')
                        )
                      )

AD_genes1
```

Lets also add in the cytoband location.
```{r, eval=FALSE}
cyto <- ADp %>% select(GENE_SYMBOL, CYTOBAND) 
AD5 <- merge(cyto, AD4, by.x='GENE_SYMBOL', by.y='GENE_SYMBOL')
head(AD5)
```

So, now we have our table of Alzheimer genes that have high CNVs and Fold Change Median values. Lets start getting this information for the other diseases to word towards building our visNetwork of genes related to other genes if any are.

We want to get these same values exactly as we have for the Alzheimer's Disease genes.
```{r, eval=FALSE}
colnames(AD5)
```
If we can't get the CYTOBAND for the other diseases then we will leave it out.
Lets write this file out to csv and work on the other disease data sets separate from this one.
```{r, eval=FALSE}
write.csv(AD5, 'useableAlzheimerStats.csv', row.names=FALSE)
```

***
***
***

%^&
!!!THE BEGINNING of our VISNETWORK!!!

Lets start by reading in those data tables we will be working with that derived the genes in the highes percentile of Copy Number Variants of genes as well as being in the bottom 5th and top 90th-99th percentiles of fold change values. The library visNetwork requires that there be an edges and a nodes data file to read from and that there be certain specific columns within each table, such as ID, to, from, label, and so on. How we will link the genes is by their ID and to see if that ID links to any other gene in our tables of disease genes. We will first read in our tables, then make sure the column names describe what disease the fold change values and CNVs are for, as well as add a field to each of these targeted genes tables that identifies the gene as being a top gene related to the disease table. Such as, pancreatic cancer, beadchip benign uterine leiomyoma, microarray benign uterine leiomyoma, gastric stomach cancer, colon cancer, or Alzheimer's Disease.

```{r}
pancreatic <- read.csv('Pancreatic_Cancer_Thresholds.csv',sep=',', header=TRUE,
                       na.strings=c('',' ','NA'))
colon <- read.csv('ColonCancerThresholds.csv',sep=',', header=TRUE,
                  na.strings=c('',' ','NA')) 
stomach <-  read.csv('GastricStomachCancer_Thresholds.csv',sep=',', header=TRUE, 
                     na.strings=c('',' ','NA'))
alzheimer <- read.csv('useableAlzheimerStats.csv',sep=',', header=TRUE,
                      na.strings=c('',' ','NA'))
ul_beadchip <- read.csv('UL_study1_thresholds.csv',sep=',', header=TRUE, 
                        na.strings=c('',' ','NA'))
ul_microarray <- read.csv('UL_microarray_thresholds.csv',sep=',', header=TRUE, 
                          na.strings=c('',' ','NA'))

```

Lets now look at each of these six diseases and add in what type of disease it is to the fields in each table that don't give that information.
```{r}
#colnames(alzheimer)[1:4] <- paste('AD',colnames(alzheimer)[1:4],sep='_')

#colnames(colon)[c(1,3,4,5)] <- paste('CC',colnames(colon)[c(1,3,4,5)],sep='_')

#colnames(stomach)[1:4] <- paste('GSC', colnames(stomach)[1:4],sep='_')

#colnames(pancreatic)[1:4] <- paste('PC', colnames(pancreatic)[1:4], sep='_')

#colnames(ul_beadchip)[1:5] <- paste('UL_beadchip', colnames(ul_beadchip)[1:5], sep='_')
#colnames(ul_beadchip)[9:46] <- gsub('UL','UL_beadchip', colnames(ul_beadchip)[9:46])

#colnames(ul_microarray)[c(1:4)] <- paste('UL_array', colnames(ul_microarray)[c(1:4)],
#                                              sep='_')
#colnames(ul_microarray)[8:13] <- gsub('UL_','UL_microarray_', colnames(ul_microarray)[8:13])
```

Lets add in the disease type field of factor type to each table.
```{r}
pancreatic$pancreatic_cancer <- as.factor('pancreatic cancer')
stomach$stomach_cancer <- as.factor('stomach cancer')
colon$colon_cancer <- as.factor('colon cancer')
alzheimer$alzheimerDisease <- as.factor('Alzheimer\'s Disease')
ul_beadchip$uterine_leiomyoma_BC <- as.factor('benign UL beadchip')
ul_microarray$uterine_leiomyoma_MA <- as.factor('benign UL microarray')
```


Pancreatic cancer data table:
```{r}
head(pancreatic)
```

Stomach cancer data table:
```{r}
head(stomach)
```

Colon cancer data table:
```{r}
head(colon)
```

Alzheimer's Disease data table:
```{r}
head(alzheimer)
```

Uterine Leiomyoma beadchip data table:
```{r}
head(ul_beadchip)
```

Uterine Leiomyoma microarray data table:
```{r}
head(ul_microarray)
```

Lets only keep the cytoband, sequence, symbol, fold change, and disease type columns of each table.

The alzheimer table already has the only fields we want, but lets rearrange and rename them to make them more consistent.
```{r}
AD1 <- alzheimer %>% select(GENE_SYMBOL:SEQUENCE,alzheimerDisease,
                            FoldChange_Median_AD_2_ctrl)
colnames(AD1) <- c('gene','cytoband','cnv','sequence','disease','foldChangeAD')
colnames(AD1)
```

The pancreatic cancer table has two fold change values for different cell lines observed. The first fold change values are of epithelial cells of PC with a tumor/cancer suppressor(ARHGEF10) added compared to not. And the second fold change values are of lymphatic cells that the cancer suppressor (ARHGEF10) was knocked out or eliminated as much as possible when compared to lymphatic cells of pancreatic cancer patients.
```{r}
PC1 <- pancreatic %>% select(Symbol,Cytoband,GENE_CNVs,SEQUENCE,pancreatic_cancer,
                             FoldChange_epithelial_PC,
                             FoldChange_lymphNode_PC
                             )
colnames(PC1) <- c('gene','cytoband','cnv','sequence','disease','foldChangePC_epith',
                   'foldChangePC_lymph')
colnames(PC1)
```

The colon cancer dataset also has two fold change values. The first is a set of LGR5 being knocked down with a shRNA, and the 2nd type is of LGR5 being knocked down with the 2nd type of shRNA.
```{r}
CC1 <- colon %>% select(Symbol,Cytoband,Symbol_CC_CNVs,SEQUENCE,colon_cancer,
                        FoldChange_CC1_to_CC0, FoldChange_CC2_to_CC0)
colnames(CC1) <- c('gene','cytoband','cnv','sequence','disease','FoldChange_CC1_to_CC0',
                   'FoldChange_CC2_to_CC0')
colnames(CC1)
```

The stomach cancer dataset has one fold change value
```{r}
GSC1 <- stomach %>% select(GENE_SYMBOL,CYTOBAND,GENE_CNVs,SEQUENCE,stomach_cancer,
                           FoldChangeMedian_GSC_to_healthyCtrl)
colnames(GSC1) <-  c('gene','cytoband','cnv','sequence','disease',
                     'FoldChangeMedian_GSC_to_healthyCtrl' )
colnames(GSC1)
```

The UL beadchip has one fold change column.
```{r}
UL_BC <- ul_beadchip %>% select(Symbol,Cytoband,Symbol_CNVs,SEQUENCE,uterine_leiomyoma_BC,
                                FoldChange_Median_UL1_to_nonUL1,
                                )
colnames(UL_BC) <-  c('gene','cytoband','cnv','sequence', 'disease',
                     'FoldChange_Median_UL1_to_nonUL1')
colnames(UL_BC)
```

The UL microarray data also has one foldchange column.
```{r}
UL_MA <- ul_microarray %>% select(GENE_SYMBOL,CYTOBAND,GENE_SYMBOL_CNVs,SEQUENCE,
                                  uterine_leiomyoma_MA,
                                  FoldChange_MedianArray_UL1_to_nonUL1)
colnames(UL_MA) <-  c('gene','cytoband','cnv','sequence', 'disease',
                     'FoldChange_MedianArray_UL1_to_nonUL1')
colnames(UL_MA)
```

Our data tables with fold change values are AD1, CC1, GSC1, PC1, UL_BC, and UL_MA. Lets look at the first few observations of each table.
```{r}
head(AD1)
```

Lets alter the cytoband field so that all values are the same format.
```{r}
AD2 <- AD1
cyto1 <- strsplit(as.character(AD2$cytoband),split='|',fixed=TRUE)
cyto2 <- lapply(cyto1,'[',2)
AD2$cytoband <- as.character(paste(cyto2))
AD2$cytoband <- as.factor(AD2$cytoband)
head(AD2)
```


```{r}
head(CC1)
```

```{r}
CC2 <- CC1
CC2$cytoband <- gsub('-','|',CC2$cytoband)
CC2$cytoband <- gsub('[|].*[a-z]{1}$','', CC2$cytoband, perl=TRUE)
CC2$cytoband <- gsub('[a-z]{1}$','', CC2$cytoband, perl=TRUE)
CC2$cytoband <- as.factor(CC2$cytoband)
head(CC2)
```


```{r}
head(GSC1)
```

```{r}
GSC2 <- GSC1
cyto1 <- strsplit(as.character(GSC2$cytoband),split='|',fixed=TRUE)
cyto2 <- lapply(cyto1,'[',2)
GSC2$cytoband <- as.character(paste(cyto2))
GSC2$cytoband <- as.factor(GSC2$cytoband)
head(GSC2)
```


```{r}
head(PC1)
```

```{r}
PC2 <- PC1
PC2$cytoband <- gsub('-','|',PC2$cytoband)
PC2$cytoband <- gsub('[|].*[a-z]{1}$','', PC2$cytoband, perl=TRUE)
PC2$cytoband <- gsub('[a-z]{1}$','', PC2$cytoband, perl=TRUE)
PC2$cytoband <- as.factor(PC2$cytoband)
head(PC2)
```


```{r}
head(UL_BC)
```

```{r}
UL_BC2 <- UL_BC
UL_BC2$cytoband <- gsub('-','|',UL_BC2$cytoband)
UL_BC2$cytoband <- gsub('[|].*[a-z]{1}$','', UL_BC2$cytoband, perl=TRUE)
UL_BC2$cytoband <- gsub('[a-z]{1}$','', UL_BC2$cytoband, perl=TRUE)
UL_BC2$cytoband <- as.factor(UL_BC2$cytoband)
UL_BC2$cytoband <- as.factor(UL_BC2$cytoband)
head(UL_BC2)
```


```{r}
head(UL_MA)
```

```{r}
UL_MA2 <- UL_MA
cyto1 <- strsplit(as.character(UL_MA2$cytoband),split='|',fixed=TRUE)
cyto2 <- lapply(cyto1,'[',2)
UL_MA2$cytoband <- as.character(paste(cyto2))
UL_MA2$cytoband <- as.factor(UL_MA2$cytoband)
head(UL_MA2)
```

Now we have our tables with the same formatted cytoband locations as factors. These tables are AD2, CC2, GSC2, PC2, UL_BC2, and UL_MA2. Lets create other tables of these six tables that have all the same values. Lets gather the fold change fields to bind all together. Four tables only have one fold change type, but the colon cancer and the pancreatic cancer have two types.
```{r}
AD3 <- gather(AD2,'foldChange','foldChangeValue',6)
CC3 <- gather(CC2,'foldChange','foldChangeValue',6:7)
PC3 <- gather(PC2,'foldChange','foldChangeValue',6:7)
GSC3 <- gather(GSC2,'foldChange','foldChangeValue',6)
UL_BC3 <- gather(UL_BC2,'foldChange','foldChangeValue',6)
UL_MA3 <-gather(UL_MA2,'foldChange','foldChangeValue',6)
```

We can now row bind these tables together.
```{r}
All_data <- rbind(AD3,CC3,PC3,GSC3,UL_BC3,UL_MA3)
```

```{r}
All <- All_data[order(All_data$gene),]
head(All,20)
```

Lets use a DT library datatable to display the new table.
```{r}
All_DT1 <- datatable(data=All,  rownames=FALSE, width = 800, height = 700,
                      extensions=c('Buttons','Responsive','FixedColumns'),
                      #filter=list(position='top'),
                      options=list(pageLength=10,
                        dom='Bfrtip',scrollX = TRUE, scrollY=TRUE,fixedColumns = TRUE,
                        buttons=c('colvis','csv'),
                        language=list(sSearch='Filter:')
                        )
                      )

All_DT1
```

Lets now see what genes are in other diseases with slicing.
```{r}
All2 <- All_data %>% select(gene,disease)
All3 <- All2[!duplicated(All2),]
All4 <- All3[order(All3$gene, decreasing=FALSE),]
head(All4)
```

Lets create a DT data table of this information showing the unique genes with their diseases associated with.
```{r}
All_DT2 <- datatable(data=All4,  rownames=FALSE, width = 800, height = 700,
                      extensions=c('Buttons','Responsive','FixedColumns'),
                      #filter=list(position='top'),
                      options=list(pageLength=10,
                        dom='Bfrtip',scrollX = TRUE, scrollY=TRUE,fixedColumns = TRUE,
                        buttons=c('colvis','csv'),
                        language=list(sSearch='Filter:')
                        )
                      )

All_DT2
```

We can see from the data table above that there are some genes that are associated with more than one disease. This will make for presumably an interesting visual network. Lets see exactly which genes are associated with more than one disease.
```{r}
All5 <- All4 %>%
  group_by(gene) %>%
  mutate(geneDiseases = n()) %>%
  select(gene,geneDiseases, disease) %>%
  ungroup() 
  
All6 <- subset(All5, All5$geneDiseases > 1)
All7 <- All6[order(All6$geneDiseases, decreasing=TRUE),]
All7
```


```{r}
length(unique(All7$gene))
unique(All7$gene)
```

We know that there are 27 genes in our data associated with more than one disease. We should just plot these diseases with visNetwork. There are other possibilities in using link analysis with visNetwork for location of the genes that are in our 792 observational data of gene targets associated with six specific diseases. And that too could be interesting to compare by cytoband location which genes are neighbors in the nucleus where transcription starts. Here are some facts about gene expression:

-DNA information is transcribed into a special
type of RNA called messenger RNA in the
nucleus (mRNA)

- mRNA is modified in the nucleus then is
transported out to the cytoplasm

- Protein synthesis, or translation, occurs in the
cytoplasm with the help of transfer RNA
molecules (tRNA) and ribosomes that contain
ribosomal RNA molecules (rRNA)

- A gene transcribed into RNA is said to be expressed

(Those aren't my words, They were taken verbatum from week 1 of a graduate coure called 'Data Systems of the Life Sciences.')

So, we are working with the All7 table on genes that are associated with more than one of our six diseases. We will use the genes as our nodes, and the edges move from the nodes of diseases if they are associated with the other diseases, and the weights as counts of how many diseases each node is associated with. Lets now recall what fields are needed to build this visual network using visNetwork. We can always attach the cytoband location with a merge of All7 to All but only selecting the gene and cytoband fields.

We need a node data frame with an id, label, and location. The label can be the gene, and the location can be the disease. We can get the id from the row number in the unique genes and locations of the All5 table. The counts in the All5 table can be the weights. Then add in the cytoband information as the location, and the label as the gene. The edges table needs the weights from the counts and the from and to columns. 

The nodes will have the id, label (gene), location (cytoband). Lets add the id field to the All5 table that groups by gene and counts the diseases per gene.
```{r}
nodes <- All5

nodes$id <- as.factor(row.names(nodes))
nodes$label <- nodes$gene
nodes$location <- nodes$disease
nodes$weight <- nodes$geneDiseases

nodes1 <- nodes %>% select(id,label,location,weight)
head(nodes1)


```

This adds in a title that will be displayed when hovered over, and also adds in a group, so that the groups will be color coded and grouped by whichever the group is being set to. Zoom in with the interactive display buttons to view the names and cluster groups once the interactive plot is ran.
```{r}
nodes3 <- All %>% select(gene,cytoband,disease)
nodes4 <- merge(nodes1,nodes3, by.x='label', by.y='gene')
nodes4$group <- nodes4$disease
nodes4$title <- nodes4$cytoband
nodes5 <- nodes4 %>% select(id,label,group,title,location,weight,cytoband)

head(nodes5)

```

The edges will have the from (id), to (disease), label, weight (counts), and width(fraction of counts for arrow width)
```{r}
nodes6 <- nodes5[!duplicated(nodes5$id),]

edges <- nodes6 %>% select(id, location, weight,cytoband)
edges$from <- edges$id
edges$width <- edges$weight/3
edges$label <- edges$location

to <- as.data.frame(unique(nodes5$location))
colnames(to) <- 'location'
to$to <- as.factor(row.names(to))

edges2 <- merge(edges,to, by.x='location', by.y='location')
edges3 <- edges2 %>% select(from,to,label,weight, width)

head(edges3)

```

Our nodes table is nodes3 and our edges table is edges3.
```{r}

visNetwork(nodes=nodes6, edges=edges3, main='Genes Associated with Six Diseases') %>% visEdges(arrows=c('from','middle')) %>%
  visInteraction(navigationButtons=TRUE, dragNodes=FALSE,
                 dragView=TRUE, zoomView = TRUE) %>%
  visOptions(nodesIdSelection = TRUE, manipulation=FALSE) %>%
  visIgraphLayout() %>%
  visLegend

```


Its great that the visual network worked but many genes are counted repeatedly and makes it cluttered. We should use the table with 57 genes of those genes that had an assoication with more than one disease in table All7. But regardless of the clutter we see that there are six clusters around the six disease types. When you zoom in on the clusters, the cluster with the most links to other diseases is the Alzheimer cluster that is associated with both UL studies, colon cancer, and stomach cancer, but not with pancreatic cancer. The UL microarray study was associated with genes in pancreatic cancer and Alzheimer disease. This is what the chart showed when we looked at it earlier, the All7 data table.

Here is the All7 datatable as a refresher of the connections seen above in the visNetwork link analysis plot.
```{r}
All7_DT3 <- datatable(data=All7, rownames=FALSE,  width = 800, height = 700,
                      extensions=c('Buttons','Responsive','FixedColumns'),
                      #filter=list(position='top'),
                      options=list(pageLength=10,
                        dom='Bfrtip',scrollX = TRUE, scrollY=TRUE,fixedColumns = TRUE,
                        buttons=c('colvis','csv'),
                        language=list(sSearch='Filter:')
                        )
                      )
                  
All7_DT3
```

The above table All7 would probably make a much better visual network analysis to view those specific genes associated with multiple diseases. In this case, five diseases, of which two were different media type for the UL samples as beadchip or microarray. These diseases were selected because they had sequence information attached to their GEO sample and platform data to make our targeted gene selections by copy number variants of genes as well as fold change values in the 5th and 95th percentile approximately. These genes out of tens of thousands fit those threshold values.

```{r}
nodes10 <- All7 %>% select(gene, disease)
nodes10$id <- row.names(nodes10)
nodes10$label <- nodes10$gene
nodes10$location <- nodes10$disease
nodes10$title <- nodes10$disease

nodes11 <- nodes10 %>% select(id,label,title,location)
head(nodes11,10)
```

```{r}
edges10 <- All7 %>% select(gene,disease, geneDiseases)
edges10$from <- row.names(All7)

to <- as.data.frame(unique(All7$disease))
colnames(to) <- 'disease'
to$to <- as.factor(row.names(to))

edges11 <- merge(to, edges10, by.x='disease', by.y='disease')
edges11$label <- edges11$disease
edges11$weight <- edges11$geneDiseases
edges11$width <- edges11$weight/2

edges12 <- edges11 %>% select(from, to, label, weight, width)
head(edges12,10)
```

```{r}
visNetwork(nodes=nodes11, edges=edges12, main='Mulitple Disease Associations of 27 Unique Genes') %>% visEdges(arrows=c('from','middle','to')) %>%
  visInteraction(navigationButtons=TRUE, dragNodes=TRUE,
                 dragView=TRUE, zoomView = TRUE) %>%
  visOptions(nodesIdSelection = TRUE, manipulation=FALSE) %>%
  visIgraphLayout()

```

Lets compare this with the underlying data of our datatable All7_DT3.
```{r}
All7_DT3
```

Lets see what this looks like to link the genes from cytoband location to other diseases in our link analysis. 
```{r}
all10 <- All %>% select(gene,cytoband,cnv,disease,foldChangeValue)
all10$foldChangeValue <- round(all10$foldChangeValue,1)
all11 <- all10[!duplicated(all10),]
row.names(all11) <- NULL
all12 <- all11[with(all11, order(cytoband)),]
row.names(all12) <- NULL
head(all12,10)
```

Lets rename and rearrange the fields above.
```{r}
all12$weight <- all12$cnv
all12$width <- all12$foldChangeValue
all12$id <- as.factor(row.names(all12))
all12$label <- all12$gene
all12$title <- all12$cytoband
all12$group <- all12$disease
all12$receiveLocation <- all12$disease
all12$sendLocation <- all12$gene
all12$from <- all12$id

to <- as.data.frame(unique(all12$receiveLocation))
colnames(to) <- 'receiveLocation'
to$to <- row.names(to)

all12b <- merge(all12,to, by.x='receiveLocation', by.y='receiveLocation')

all13 <- all12b %>% select(id,label,title,group,sendLocation,receiveLocation,weight,width,from,to)

head(all13,10)
```

Build the nodes and edges tables. The weight in this set is the gene CNVs per disease. Previously it was the number of diseases each gene was associated with.
```{r}
nodes15 <- all13 %>% select(id,label,title, group,sendLocation)
edges14 <- all13 %>% select(from,to,receiveLocation,weight,width)
edges14$label <- edges14$receiveLocation
edges15 <- edges14 %>% select(from,to,label,weight, width)

```

```{r}
visNetwork(nodes=nodes15, edges=edges15, main='Cytoband Nodes and Disease Association') %>% visEdges(arrows=c('from','middle','to')) %>%
  visInteraction(navigationButtons=TRUE, dragNodes=TRUE,
                 dragView=TRUE, zoomView = TRUE) %>%
  visOptions(nodesIdSelection = TRUE, manipulation=FALSE) %>%
  visIgraphLayout() %>%
  visLegend(ncol=2)
```




Lets move some stuff around and see what happens.
```{r}
all10 <- All %>% select(gene,cytoband,cnv,disease,foldChangeValue)
all10$foldChangeValue <- round(all10$foldChangeValue,1)
all11 <- all10[!duplicated(all10),]
row.names(all11) <- NULL
all12 <- all11[with(all11, order(cytoband)),]
row.names(all12) <- NULL
head(all12,10)
```

Lets rename and rearrange the fields above.
```{r}
all12$weight <- all12$cnv
all12$width <- all12$foldChangeValue
all12$id <- as.factor(row.names(all12))
all12$label <- all12$disease
all12$receiveLocation <- all12$gene
all12$sendLocation <- all12$disease
all12$from <- all12$id

to <- as.data.frame(unique(all12$receiveLocation))
colnames(to) <- 'receiveLocation'
to$to <- row.names(to)

all12b <- merge(all12,to, by.x='receiveLocation', by.y='receiveLocation')

all13 <- all12b %>% select(id,label,sendLocation,receiveLocation,weight,width,from,to)

head(all13,10)
```

Build the nodes table.
```{r}
nodes15 <- all13 %>% select(id,label,sendLocation)
edges14 <- all13 %>% select(from,to,receiveLocation,weight,width)
edges14$label <- edges14$receiveLocation
edges15 <- edges14 %>% select(from,to,label,weight, width)

```

```{r}
visNetwork(nodes=nodes15, edges=edges15, main='Disease as Nodes and Genes as Edges') %>% visEdges(arrows=c('from','middle','to')) %>%
  visInteraction(navigationButtons=TRUE, dragNodes=TRUE,
                 dragView=TRUE, zoomView = TRUE) %>%
  visOptions(nodesIdSelection = TRUE, manipulation=FALSE) %>%
  visIgraphLayout()
```

